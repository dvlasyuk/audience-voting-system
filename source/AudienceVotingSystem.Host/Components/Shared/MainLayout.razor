@inherits LayoutComponentBase

@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using MudBlazor

@inject AuthenticationProvider AuthenticationProvider
@inject NavigationManager NavigationManager

<AuthorizeView Roles="Administrator">
    <Authorized>

        <MudThemeProvider IsDarkMode="true" />
        <MudPopoverProvider />

        <MudLayout>

            <MudAppBar>
                <MudIconButton aria-label="Главное меню"
                               Icon="@Icons.Material.Filled.Home"
                               Variant="Variant.Outlined"
                               Color="Color.Primary"
                               Edge="Edge.Start"
                               Href="/" />

                <MudImage Src="favicon-32.png" Class="ml-5" />
                <MudText Typo="Typo.h6" Class="ml-2">Система зрительского голосования СПбСО</MudText>

                <MudSpacer />
                <MudIconButton aria-label="Выйти из системы"
                               Icon="@Icons.Material.Filled.Logout"
                               Variant="Variant.Outlined"
                               OnClick="OnSignOutFromSystem" />
            </MudAppBar>

            <MudMainContent>
                <MudContainer Fixed="true" Class="pt-3">
                    @Body
                </MudContainer>
            </MudMainContent>

        </MudLayout>
    </Authorized>

    <NotAuthorized>
        <PageTitle>Вход в систему</PageTitle>
        <LayoutView Layout="@typeof(BaseLayout)">
            <SignInForm />
        </LayoutView>
    </NotAuthorized>

</AuthorizeView>

@code {

    private async Task OnSignOutFromSystem()
    {
        await AuthenticationProvider.SignOut();
        NavigationManager.NavigateTo(NavigationManager.Uri, true);
    }
}
